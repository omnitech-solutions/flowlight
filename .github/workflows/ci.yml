name: CI

on:
    push:
        branches: [ "master", "main" ]
    pull_request:
        branches: [ "master", "main" ]

jobs:
    tests:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Set up PHP
              uses: shivammathur/setup-php@v2
              with:
                  php-version: '8.3'
                  extensions: xdebug
                  coverage: xdebug

            - name: Install dependencies
              run: composer install --prefer-dist --no-progress --no-suggest

            - name: Run CI pipeline
              run: make ci

            - name: Upload coverage report
              if: always()
              uses: actions/upload-artifact@v4
              with:
                  name: coverage-report
                  path: coverage
